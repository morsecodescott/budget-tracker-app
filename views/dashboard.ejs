<!-- views/dashboard.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Header Template-->
    <%- include('header'); -%>

    <div class="container">
        <h2>Welcome to your Dashboard</h2>
        <!-- Add your dashboard components here -->
        <div class="budget-info">
            <h3>Your Budget Information</h3>
            <%- include('partials/budgetItemsTable') %>
        </div>
        <div class="account-details">
            <h3>Your Account Details</h3>
            <!-- Display account details here -->
        </div>
<div class="budget-add">
    <%- include('partials/flashMessages') %>

    <%- include('partials/addBudgetItemForm') %>

</div>

    </div>

    <script>
        document.querySelectorAll('.budget-item-delete').forEach(button => {
            button.addEventListener('click', function(e) {
                const itemId = this.getAttribute('data-id');
                
                if(confirm('Are you sure?')) {
                    fetch(`/budget/delete/${itemId}`, {
                        method: 'DELETE',
                    })
                    .then(res => window.location.reload()) // Reload the page to reflect changes
                    .catch(err => console.error('Error:', err));
                }
            });
        });

    function openEditModal(id, type, amount, frequency, description) {
    // Populate the form fields with parameters
    document.getElementById('editType').value = type;
    document.getElementById('editAmount').value = amount;
    document.getElementById('editFrequency').value = frequency;
    document.getElementById('editDescription').value = description;
    document.getElementById('editItemId').value = id;

    // Show the modal
    document.getElementById('editBudgetModal').style.display = 'block';
    }

    function closeEditModal() {
    document.getElementById('editBudgetModal').style.display = 'none';
    }

    function saveChanges() {
    const itemId = document.getElementById('editItemId').value;
    const formData = {
        type: document.getElementById('editType').value,
        amount: document.getElementById('editAmount').value,
        frequency: document.getElementById('editFrequency').value,
        description: document.getElementById('editDescription').value,
    };

    fetch(`/budget/${itemId}`, {
        method: 'PUT', // Use 'PUT' or 'PATCH' as per your backend implementation
        headers: {
        'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData),
    })
    .then(response => response.json())
    .then(data => {
        console.log('Success:', data);
        closeEditModal();
        // Refresh the part of the page that shows budget items, or redirect as needed
        // window.location.reload(); // Uncomment if you want to reload the page or implement a more dynamic update
    })
    .catch((error) => {
        console.error('Error:', error);
    });
    }


        </script>
</body>
</html>
