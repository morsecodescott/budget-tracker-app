<!-- views/dashboard.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Header Template-->
    <%- include('header'); -%>

    <div class="container">
        <h2>Welcome to your Dashboard</h2>
        <!-- Add your dashboard components here -->
        <div class="budget-info">
            <h3>Your Budget Information</h3>
            <%- include('partials/budgetItemsTable') %>
            <%- include('partials/flashMessages') %>
            <%- include('partials/budgetItemForm') %>
        </div>
        <div class="account-details">
            <h3>Your Account Details</h3>
            <!-- Display account details here -->
        </div>


    </div>

    <script>
        document.querySelectorAll('.budget-item-delete').forEach(button => {
            button.addEventListener('click', function(e) {
                const itemId = this.getAttribute('data-id');
                
                if(confirm('Are you sure?')) {
                    fetch(`/budget/delete/${itemId}`, {
                        method: 'DELETE',
                    })
                    .then(res => window.location.reload()) // Reload the page to reflect changes
                    .catch(err => console.error('Error:', err));
                }
            });
        });

        function openAddModal() {
            document.getElementById('modalTitle').textContent = 'Add Budget Item';
            document.getElementById('budgetItemForm').reset(); // Reset the form to ensure it's clear
            document.getElementById('itemId').value = ''; // Ensure itemId is empty for an add action
            document.getElementById('budgetItemModal').style.display = 'block';
            }

            function openEditModal(id, type, amount, frequency, description) {
            document.getElementById('modalTitle').textContent = 'Edit Budget Item';
            document.getElementById('type').value = type;
            document.getElementById('amount').value = amount;
            document.getElementById('frequency').value = frequency;
            document.getElementById('description').value = description;
            document.getElementById('itemId').value = id; // Populate the hidden field with the item's ID
            document.getElementById('budgetItemModal').style.display = 'block';
            }

            function closeModal() {
            document.getElementById('budgetItemModal').style.display = 'none';
            }

            function submitForm() {
            const itemId = document.getElementById('itemId').value;
            const isEdit = itemId !== '';
            const form = document.getElementById('budgetItemForm');
            const formData = new FormData(form);
            const formAction = isEdit ? `/budget/${itemId}` : '/budget';
            const method = isEdit ? 'PUT' : 'POST';

            fetch(formAction, {
                method: method,
                body: JSON.stringify(Object.fromEntries(formData)),
                headers: {
                'Content-Type': 'application/json',
                },
            })
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok.');
                return response.json();
            })
            .then(data => {
                console.log('Success:', data);
                closeModal();
                // Refresh the budget item list or update the UI dynamically here
            })
            .catch((error) => {
                console.error('Error:', error);
            });
            }


        </script>
</body>
</html>
